---
layout: post
category: 云计算
tags: docker
description: 本文主要分析docker容器跨主机连接实现方式，参考自官方文档。
---

### 问题
  1. 主机1上启动一个运行redis-server的docker容器
  2. 从主机2上运行redis-cli的docker容器访问主机1上docker容器中的redis-server
  
### 官方方案

	(consumer) --> (redis-ambassador) ---network---> (redis-ambassador) --> (redis)

### redis-ambassador

其中运行socat进行数据转发。

### 服务端

#### redis-server

~~~
	
	docker run -d --name redis shipyard/redis
	5ea7e8765ad4f94e97514abadf730a682a16fe6ed4ef221ea0b659e2381b256b
	docker inspect 5ea7e8765ad4f94e97514abadf730a682a16fe6ed4ef221ea0b659e2381b256b
	paas@ubuntu:~$ docker inspect 5ea7e8765ad4f94e97514abadf730a682a16fe6ed4ef221ea0b659e2381b256b
[{
    "ID": "5ea7e8765ad4f94e97514abadf730a682a16fe6ed4ef221ea0b659e2381b256b",
    "Created": "2014-05-08T02:44:09.077262462Z",
    "Path": "/usr/local/bin/redis-server",
    "Args": [
        "/etc/redis.conf"
    ],
    "Config": {
        "Hostname": "5ea7e8765ad4",
        "Domainname": "",
        "User": "",
        "Memory": 0,
        "MemorySwap": 0,
        "CpuShares": 0,
        "AttachStdin": false,
        "AttachStdout": false,
        "AttachStderr": false,
        "PortSpecs": null,
        "ExposedPorts": {
            "6379/tcp": {}
        },
        "Tty": false,
        "OpenStdin": false,
        "StdinOnce": false,
        "Env": [
            "HOME=/",
            "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
        ],
        "Cmd": [
            "/etc/redis.conf"
        ],
        "Image": "shipyard/redis",
        "Volumes": {
            "/var/lib/redis": {}
        },
        "WorkingDir": "",
        "Entrypoint": [
            "/usr/local/bin/redis-server"
        ],
        "NetworkDisabled": false,
        "OnBuild": null
    },
    "State": {
        "Running": true,
        "Pid": 2848,
        "ExitCode": 0,
        "StartedAt": "2014-05-08T02:44:09.143283104Z",
        "FinishedAt": "0001-01-01T00:00:00Z",
        "Ghost": false
    },
    "Image": "b48b681ac98459fdc7efc98c9cce7e25f8b1537a4496aad9d355b3b11ca7144a",
    "NetworkSettings": {
        "IPAddress": "172.17.0.3",
        "IPPrefixLen": 16,
        "Gateway": "172.17.42.1",
        "Bridge": "docker0",
        "PortMapping": null,
        "Ports": {
            "6379/tcp": null
        }
    },
    "ResolvConfPath": "/var/lib/docker/containers/5ea7e8765ad4f94e97514abadf730a682a16fe6ed4ef221ea0b659e2381b256b/resolv.conf",
    "HostnamePath": "/var/lib/docker/containers/5ea7e8765ad4f94e97514abadf730a682a16fe6ed4ef221ea0b659e2381b256b/hostname",
    "HostsPath": "/var/lib/docker/containers/5ea7e8765ad4f94e97514abadf730a682a16fe6ed4ef221ea0b659e2381b256b/hosts",
    "Name": "/redis",
    "Driver": "aufs",
    "ExecDriver": "native-0.1",
    "Volumes": {
        "/var/lib/redis": "/var/lib/docker/vfs/dir/f63db2f2ef851765d260ccd74c0d529b91865738013d0e94d61d791dbd7e08fa"
    },
    "VolumesRW": {
        "/var/lib/redis": true
    },
    "HostConfig": {
        "Binds": null,
        "ContainerIDFile": "",
        "LxcConf": [],
        "Privileged": false,
        "PortBindings": {
            "6379/tcp": null
        },
        "Links": null,
        "PublishAllPorts": false,
        "Dns": null,
        "DnsSearch": null,
        "VolumesFrom": null
    }
}]

~~~

#### svendowideit/ambassador

	docker run -d --link redis:redis --name redis_ambassador -p 6379:6379 svendowideit/ambassador

### 客户端